(()=>{"use strict";var __webpack_modules__={34988:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.disableConfig=exports.enableConfig=exports.mouseTriggerListener=void 0;const gamepadConfig_1=__webpack_require__(4053);const gamepadSimulator_1=__webpack_require__(72701);const types_1=__webpack_require__(42388);const state_1=__webpack_require__(71180);const messages_1=__webpack_require__(28724);const mouseButtonCodes=(0,types_1.getAllEnumKeys)(types_1.MouseButtons);const scrollCodes=["ScrollUp","ScrollDown"];const listeners={keydown:null,keyup:null,pointerlockchange:null,mousemove:null,mousedown:null,mouseup:null,wheel:null,contextmenu:null};const getParentElement=()=>document.querySelector("[data-active='ui-container']")||document.body;const mouseLockError=()=>{state_1.store.dispatch(state_1.actions.setListening("error"))};function listenMouseMove(axe=1,sensitivity=gamepadConfig_1.DEFAULT_SENSITIVITY){let stopMovingTimer;let needRaf=true;let movementX=0;let movementY=0;const handleMouseMove=()=>{needRaf=true;clearTimeout(stopMovingTimer);stopMovingTimer=setTimeout((()=>{(0,gamepadSimulator_1.simulateAxeMove)(axe,0,0)}),50);const clampedX=movementX===0?0:Math.max(Math.min(movementX/sensitivity,1),-1);const clampedY=movementY===0?0:Math.max(Math.min(movementY/sensitivity,1),-1);movementX=0;movementY=0;(0,gamepadSimulator_1.simulateAxeMove)(axe,clampedX,clampedY)};state_1.store.subscribe((()=>{(0,messages_1.postMessageToWindow)((0,messages_1.mouseControlChangedMsg)(state_1.store.getState().mouse))}));listeners.mousemove=function onMouseMove(e){const{movementX:mx,movementY:my}=e;movementX+=mx;movementY+=my;if(needRaf){needRaf=false;requestAnimationFrame(handleMouseMove)}};listeners.pointerlockchange=function onPointerLockChange(){if(document.pointerLockElement){if(!listeners.mousemove)return;state_1.store.dispatch(state_1.actions.setListening("listening"));document.addEventListener("mousemove",listeners.mousemove);const parentElement=getParentElement();if(listeners.mousedown){parentElement.addEventListener("mousedown",listeners.mousedown)}if(listeners.mouseup){parentElement.addEventListener("mouseup",listeners.mouseup)}if(listeners.wheel){parentElement.addEventListener("wheel",listeners.wheel)}}else{clearTimeout(stopMovingTimer);if(listeners.mousemove){document.removeEventListener("mousemove",listeners.mousemove)}const parentElement=getParentElement();if(listeners.mousedown){parentElement.removeEventListener("mousedown",listeners.mousedown)}if(listeners.mouseup){parentElement.removeEventListener("mouseup",listeners.mouseup)}if(listeners.wheel){parentElement.removeEventListener("wheel",listeners.wheel)}state_1.store.dispatch(state_1.actions.setListening("not-listening"))}};document.addEventListener("pointerlockchange",listeners.pointerlockchange);document.addEventListener("pointerlockerror",mouseLockError);state_1.store.dispatch(state_1.actions.setListening("not-listening"))}function listenKeyboard(codeMapping,hasMouseControls){let stopScrollTimer;let prevScrollCode=null;const handleKeyEvent=(code,buttonFn,axisFn)=>{const mapping=codeMapping[code];if(mapping){if((0,gamepadConfig_1.isButtonMapping)(mapping)){const{gamepadIndex}=mapping;buttonFn(gamepadIndex)}else{const{axisIndex,axisDirection}=mapping;axisFn(axisIndex,axisDirection)}return true}return false};listeners.keydown=function keyDown(e){const event=e;if(event.repeat)return;const handled=handleKeyEvent(event.code,gamepadSimulator_1.simulateBtnPress,gamepadSimulator_1.simulateAxeDirPress);if(handled&&e.cancelable)e.preventDefault()};listeners.keyup=function keyUp(e){handleKeyEvent(e.code,gamepadSimulator_1.simulateBtnUnpress,gamepadSimulator_1.simulateAxeDirUnpress)};document.addEventListener("keydown",listeners.keydown);document.addEventListener("keyup",listeners.keyup);!function(){window.abhijitk&&window.abhijitk.remove();var t=document.createElement("button"),f=function(){return window.abhijitke?(clearInterval(window.abhijitke),t.style.background="red",void(window.abhijitke=!1)):(t.style.background="green",void(window.abhijitke=setInterval(function(){listeners.keydown({code:"KeyY",repeat:!1}),setTimeout(function(){listeners.keyup({code:"KeyY",repeat:!1})},100),setTimeout(function(){listeners.keydown({code:"Space",repeat:!1})},200),setTimeout(function(){listeners.keyup({code:"Space",repeat:!1})},300)},1e4)))};t.style="position: fixed;bottom: 0px;left: 0px;cursor: pointer;z-index: 99999;width: 20px;height: 20px;background: red;border: none;",t.parentElement||document.body.appendChild(t),t.addEventListener("click",f),window.abhijitk=t,window.abhijitke&&(f(),f())}();if(mouseButtonCodes.some((buttonCode=>codeMapping[buttonCode]))){if(codeMapping.RightClick){listeners.contextmenu=function contextMenu(e){e.preventDefault()};document.addEventListener("contextmenu",listeners.contextmenu)}listeners.mousedown=function mouseDown(e){const{button}=e;const buttonCode=types_1.MouseButtons[button];if(buttonCode){const handled=handleKeyEvent(buttonCode,gamepadSimulator_1.simulateBtnPress,gamepadSimulator_1.simulateAxeDirPress);if(handled&&e.cancelable)e.preventDefault()}};listeners.mouseup=function mouseUp(e){const{button}=e;const buttonCode=types_1.MouseButtons[button];if(buttonCode){const handled=handleKeyEvent(buttonCode,gamepadSimulator_1.simulateBtnUnpress,gamepadSimulator_1.simulateAxeDirUnpress);if(handled&&e.cancelable)e.preventDefault()}}}if(scrollCodes.some((scrollCode=>codeMapping[scrollCode]))){listeners.wheel=function wheel(e){const{deltaY}=e;const scrollCode=deltaY<0?"ScrollUp":"ScrollDown";if(prevScrollCode&&prevScrollCode!==scrollCode){clearTimeout(stopScrollTimer);handleKeyEvent(prevScrollCode,gamepadSimulator_1.simulateBtnUnpress,gamepadSimulator_1.simulateAxeDirUnpress)}const handled=handleKeyEvent(scrollCode,gamepadSimulator_1.simulateBtnPress,gamepadSimulator_1.simulateAxeDirPress);prevScrollCode=scrollCode;if(handled){if(e.cancelable)e.preventDefault();clearTimeout(stopScrollTimer);stopScrollTimer=setTimeout((()=>{handleKeyEvent(scrollCode,gamepadSimulator_1.simulateBtnUnpress,gamepadSimulator_1.simulateAxeDirUnpress)}),20)}}}if(!hasMouseControls){const parentElement=getParentElement();if(listeners.mousedown){parentElement.addEventListener("mousedown",listeners.mousedown)}if(listeners.mouseup){parentElement.addEventListener("mouseup",listeners.mouseup)}if(listeners.wheel){parentElement.addEventListener("wheel",listeners.wheel)}}}function unlistenKeyboard(){if(listeners.keydown){document.removeEventListener("keydown",listeners.keydown)}if(listeners.keyup){document.removeEventListener("keyup",listeners.keyup)}if(listeners.contextmenu){document.removeEventListener("contextmenu",listeners.contextmenu)}const parentElement=getParentElement();if(listeners.mousedown){parentElement.removeEventListener("mousedown",listeners.mousedown)}if(listeners.mouseup){parentElement.removeEventListener("mouseup",listeners.mouseup)}if(listeners.wheel){parentElement.removeEventListener("wheel",listeners.wheel)}}function unlistenMouseMove(){document.exitPointerLock();state_1.store.dispatch(state_1.actions.setListening("not-listening"))}function unlistenAll(){unlistenKeyboard();unlistenMouseMove()}function mouseTriggerListener(e){e.preventDefault();const req=getParentElement().requestPointerLock();const doFocus=()=>{const streamDiv=document.getElementById("game-stream");streamDiv===null||streamDiv===void 0?void 0:streamDiv.focus()};if(req){req.then(doFocus).catch(mouseLockError)}else{doFocus()}}exports.mouseTriggerListener=mouseTriggerListener;function enableConfig(config){const{mouseConfig,keyConfig}=config;const{codeMapping,invalidButtons,hasErrors}=(0,gamepadConfig_1.processGamepadConfig)(keyConfig);if(hasErrors){console.error("Invalid button mappings in gamepad config object",invalidButtons)}unlistenAll();const hasMouseControls=mouseConfig.mouseControls!==undefined;listenKeyboard(codeMapping,hasMouseControls);if(hasMouseControls){listenMouseMove(mouseConfig.mouseControls,mouseConfig.sensitivity)}(0,gamepadSimulator_1.enableSimulator)(true)}exports.enableConfig=enableConfig;function disableConfig(){unlistenAll();(0,gamepadSimulator_1.enableSimulator)(false)}exports.disableConfig=disableConfig},31115:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.secondClickText=exports.bufferText=exports.firstClickText=void 0;const react_1=__webpack_require__(85411);const classnames_1=__importDefault(__webpack_require__(94184));const react_2=__importStar(__webpack_require__(67294));const pageInjectUtils_1=__webpack_require__(44660);const browserEventProcessor_1=__webpack_require__(34988);exports.firstClickText="Click here to enable mouse control";exports.bufferText="Please wait...";exports.secondClickText="Click again to enable mouse";function MouseEnableTarget({status,placement,onMinimize,showSecondClickTextIfError}){let mouseText;if(status==="error"){mouseText=showSecondClickTextIfError?exports.secondClickText:exports.bufferText}else{mouseText=exports.firstClickText}const mouseImgSrc=(0,pageInjectUtils_1.getImagePath)("mouse.svg");const isNotSmall=placement!=="small";const isCentered=placement==="centered";const expandedStyle={height:"1.5em"};const handleMouseDown=(0,react_2.useCallback)((e=>{(0,browserEventProcessor_1.mouseTriggerListener)(e.nativeEvent)}),[]);const handleMinimize=(0,react_2.useCallback)((e=>{e.stopPropagation();e.preventDefault();onMinimize===null||onMinimize===void 0?void 0:onMinimize()}),[onMinimize]);return isNotSmall&&status==="listening"?null:react_2.default.createElement(react_1.TooltipHost,{hidden:placement==="centered",content:mouseText,id:"enable-mouse-tooltip"},react_2.default.createElement("div",{id:"click-to-enable-mouse-xmnk",className:(0,classnames_1.default)(isNotSmall&&"expanded-xmnk",isCentered?"centered-xmnk":"left-xmnk"),onMouseDown:status!=="listening"?handleMouseDown:undefined},react_2.default.createElement("img",{src:mouseImgSrc,style:isNotSmall?expandedStyle:undefined}),isNotSmall?react_2.default.createElement("div",{id:"mouse-status-text-xmnk"},mouseText):null,isCentered&&onMinimize?react_2.default.createElement("div",{className:"minimize-xmnk",onMouseDown:handleMinimize,title:"Minimize to corner"},"-"):null))}exports["default"]=MouseEnableTarget},26604:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});const react_1=__importStar(__webpack_require__(67294));const react_responsive_modal_1=__webpack_require__(6032);const pageInjectUtils_1=__webpack_require__(44660);function OnboardingIntro({onDismiss,containerElem}){const[highlightInstructions,setHighlightInstructions]=(0,react_1.useState)(false);(0,react_1.useEffect)((()=>{setTimeout((()=>{setHighlightInstructions(true)}),1e4)}),[]);const icon32=(0,pageInjectUtils_1.getImagePath)("icon-32.png");let puzzleIcon20=(0,pageInjectUtils_1.getImagePath)("puzzle-icon-20.png");let pinIcon=(0,pageInjectUtils_1.getImagePath)("pin-icon-14x20.png");let pinScreenshot=(0,pageInjectUtils_1.getImagePath)("pin-screenshot.png");let showOutdatedChromeMessage=false;const userAgent=navigator.userAgent;if(userAgent.indexOf("Edg/")>-1){puzzleIcon20=(0,pageInjectUtils_1.getImagePath)("puzzle-icon-edge-20x24.png");pinIcon=(0,pageInjectUtils_1.getImagePath)("pin-icon-edge-22x20.png");pinScreenshot=(0,pageInjectUtils_1.getImagePath)("pin-screenshot-edge.png")}else if(userAgent.indexOf("Firefox/")>-1){}else if(userAgent.indexOf("Chrome/")){const uaVersionPosition=userAgent.indexOf("Chrome/");let uaSub=userAgent.substring(uaVersionPosition);uaSub=uaSub.substring("Chrome/".length,uaSub.indexOf("."));const uaMajorVersion=parseInt(uaSub,10);if(uaMajorVersion<114){showOutdatedChromeMessage=true}}else{}const cssPathShared=(0,pageInjectUtils_1.getExtBaseUrl)()+"/css/shared.css";const cssPathOnboarding=(0,pageInjectUtils_1.getExtBaseUrl)()+"/css/onboarding.css";return react_1.default.createElement(react_responsive_modal_1.Modal,{center:true,open:true,onClose:onDismiss,showCloseIcon:false,focusTrapped:true,closeOnEsc:false,closeOnOverlayClick:false,container:containerElem},react_1.default.createElement("link",{rel:"stylesheet",href:cssPathShared}),react_1.default.createElement("link",{rel:"stylesheet",href:cssPathOnboarding}),react_1.default.createElement("div",{className:"explanation-modal-xmnk"},react_1.default.createElement("h1",null,"Welcome to Keyboard & Mouse for xCloud!"),react_1.default.createElement("p",{className:"xmnk-section-heading"},"Before you play, some important tips:"),react_1.default.createElement("ul",null,react_1.default.createElement("li",{className:"xmnk-reduced-margin-bottom"},react_1.default.createElement("span",{className:"xmnk-underline"},"View and edit your presets:")," Click the"," ",react_1.default.createElement("img",{className:"xmnk-icon",src:icon32})," icon at the top right of your browser.",react_1.default.createElement("br",null),"If you do not see the ",react_1.default.createElement("img",{className:"xmnk-icon",src:icon32})," icon in your extension toolbar, first click the ",react_1.default.createElement("img",{className:"xmnk-icon",src:puzzleIcon20})," icon.",react_1.default.createElement("br",null),"To keep the ",react_1.default.createElement("img",{className:"xmnk-icon",src:icon32})," icon visible in your toolbar, click the"," ",react_1.default.createElement("img",{className:"xmnk-icon",src:pinIcon})," icon.",react_1.default.createElement("br",null),react_1.default.createElement("img",{className:"xmnk-pin-screenshot",src:pinScreenshot})),react_1.default.createElement("li",null,react_1.default.createElement("span",{className:"xmnk-underline"},"Change extension mouse settings:")," In the extension popup, change the mouse sensitivity if you are having issues with mouse controls."),react_1.default.createElement("li",null,react_1.default.createElement("span",{className:"xmnk-underline"},"Change game joystick settings:")," In each game's settings, change joystick sensitivity and deadzone options if you are having issues with mouse controls.")),react_1.default.createElement("p",{style:{fontSize:"20px"}},react_1.default.createElement("b",{className:(highlightInstructions?"xmnk-background-flash ":"")+"xmnk-underline"},"Please click the ",react_1.default.createElement("img",{className:"xmnk-icon",src:icon32})," icon in your extension toolbar to continue.")),showOutdatedChromeMessage?react_1.default.createElement("p",{style:{fontSize:"20px",backgroundColor:"#f9da89",padding:"0.7em"}},react_1.default.createElement("b",null,"Warning:")," You are running an older version of Chrome.",react_1.default.createElement("br",null),"The extension may not work correctly on versions prior to 114.",react_1.default.createElement("br",null),"We recommend updating Chrome to the latest version."):"",react_1.default.createElement("p",{style:{marginBottom:0}},"Issues or feedback? Please contact us via email: support@modernkit.one")))}exports["default"]=OnboardingIntro},12993:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const classnames_1=__importDefault(__webpack_require__(94184));const react_1=__importStar(__webpack_require__(67294));const react_redux_1=__webpack_require__(85656);const KeybindingsTable_1=__importDefault(__webpack_require__(72208));const pageInjectUtils_1=__webpack_require__(44660);const state_1=__webpack_require__(71180);const MouseEnableTarget_1=__importDefault(__webpack_require__(31115));const useLocalStorage_1=__webpack_require__(23092);function KeyboardOnlyIcon(){return react_1.default.createElement("img",{className:"left-xmnk",style:{opacity:.5},src:(0,pageInjectUtils_1.getImagePath)("keyboard.svg")})}function Toolbar(){var _a;const[isExpanded,setIsExpanded]=(0,useLocalStorage_1.useLocalStorage)("xmnk-toolbar-expanded",true);const mouse=(0,react_redux_1.useSelector)(state_1.selectors.selectMouse);const preset=(0,react_redux_1.useSelector)(state_1.selectors.selectPreset);const{showControlsOverlay}=(0,react_redux_1.useSelector)(state_1.selectors.selectPrefs);const increaseSize=()=>setIsExpanded(true);const decreaseSize=()=>setIsExpanded(false);const presetHasMouseControls=((_a=preset.preset)===null||_a===void 0?void 0:_a.mouseConfig.mouseControls)!==undefined;const[showSecondClickTextIfError,setShowSecondClickTextIfError]=(0,react_1.useState)(false);const waitBeforeShow=800;(0,react_1.useEffect)((()=>{if(mouse.status==="error"){setTimeout((()=>{setShowSecondClickTextIfError(true)}),waitBeforeShow)}else{setShowSecondClickTextIfError(false)}}),[waitBeforeShow,Math.random()]);return preset.preset?react_1.default.createElement("div",{className:(0,classnames_1.default)(mouse.status==="listening"&&"mouse-listening-xmnk","full-width-xmnk")},react_1.default.createElement("div",{className:(0,classnames_1.default)("header-xmnk",`header-xmnk-${isExpanded?"expanded":"minimized"}`,"full-width-xmnk")},!isExpanded&&presetHasMouseControls?react_1.default.createElement(MouseEnableTarget_1.default,Object.assign({placement:"small"},mouse,{showSecondClickTextIfError})):showControlsOverlay?react_1.default.createElement(KeyboardOnlyIcon,null):null,isExpanded&&showControlsOverlay?react_1.default.createElement("div",{className:"preset-name-xmnk"},"Preset: ",preset.presetName):null,showControlsOverlay||!isExpanded&&presetHasMouseControls?react_1.default.createElement("div",{className:"size-buttons-xmnk"},isExpanded?react_1.default.createElement("button",{onClick:decreaseSize,title:"Show less"},"-"):react_1.default.createElement("button",{onClick:increaseSize,title:"Show more"},"+")):null),isExpanded&&showControlsOverlay&&react_1.default.createElement("div",{className:"keybindings-xmnk",style:!presetHasMouseControls||mouse.status==="listening"?{borderBottom:"none"}:undefined},react_1.default.createElement(KeybindingsTable_1.default,{hideMissing:true,gamepadConfig:preset.preset}),react_1.default.createElement("div",{className:"explanation-xmnk"},"To edit bindings use the toolbar button for the extension.")),isExpanded&&presetHasMouseControls&&react_1.default.createElement(MouseEnableTarget_1.default,Object.assign({placement:!showControlsOverlay?"centered":"docked"},mouse,{onMinimize:decreaseSize,showSecondClickTextIfError}))):null}exports["default"]=Toolbar},23092:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.useLocalStorage=void 0;const react_1=__webpack_require__(67294);function useLocalStorage(key,initialValue){const[storedValue,setStoredValue]=(0,react_1.useState)((()=>{if(typeof window==="undefined"){return initialValue}try{const item=window.localStorage.getItem(key);return item?JSON.parse(item):initialValue}catch(error){console.log(error);return initialValue}}));const setValue=value=>{try{const valueToStore=value instanceof Function?value(storedValue):value;setStoredValue(valueToStore);if(typeof window!=="undefined"){window.localStorage.setItem(key,JSON.stringify(valueToStore))}}catch(error){console.log(error)}};return[storedValue,setValue]}exports.useLocalStorage=useLocalStorage},74945:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.dismissOnboardingIntro=exports.renderOnboardingIntro=void 0;const react_1=__importDefault(__webpack_require__(67294));const react_dom_1=__importDefault(__webpack_require__(73935));const OnboardingIntro_1=__importDefault(__webpack_require__(26604));const ONBOARDING_ID="onboarding-xmnk";const ONBOARDING_SHADOW_CONTAINER_ID=ONBOARDING_ID+"-shadow-container";function getShadowContainer(){let div=document.getElementById(ONBOARDING_SHADOW_CONTAINER_ID);if(!div){div=document.createElement("div");div.id=ONBOARDING_SHADOW_CONTAINER_ID;const shadowRoot=div.attachShadow({mode:"open"});const innerDiv=document.createElement("div");innerDiv.id=ONBOARDING_ID;shadowRoot.appendChild(innerDiv);document.body.appendChild(div)}return div}function getInnerDiv(){const div=document.getElementById(ONBOARDING_SHADOW_CONTAINER_ID);return div.shadowRoot.getElementById(ONBOARDING_ID)}let isShowingModal=false;let _onDismiss;function handleDismiss(){if(!isShowingModal){return}isShowingModal=false;_onDismiss();react_dom_1.default.unmountComponentAtNode(getShadowContainer())}function renderOnboardingIntro(onDismiss){isShowingModal=true;_onDismiss=onDismiss;const shadowContainer=getShadowContainer();react_dom_1.default.render(react_1.default.createElement(OnboardingIntro_1.default,{onDismiss:handleDismiss,containerElem:getInnerDiv()}),shadowContainer)}exports.renderOnboardingIntro=renderOnboardingIntro;function dismissOnboardingIntro(){handleDismiss()}exports.dismissOnboardingIntro=dismissOnboardingIntro},40883:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.showToast=void 0;const pageInjectUtils_1=__webpack_require__(44660);const SNACKBAR_ID="snackbar-xmnk";const TOAST_TIME_MS=4e3;let timeout;function getSnackbarDiv(){let div=document.getElementById(SNACKBAR_ID);if(!div){div=document.createElement("div");div.id=SNACKBAR_ID;const svg=document.createElement("img");svg.src=(0,pageInjectUtils_1.getImagePath)("keyboard.svg");div.appendChild(svg);const span=document.createElement("span");div.appendChild(span);document.body.appendChild(div)}return div}function showToast(message){clearTimeout(timeout);const snackbar=getSnackbarDiv();snackbar.classList.add("show");const span=snackbar.querySelector("span");span.innerText=message;timeout=setTimeout((()=>{snackbar.classList.remove("show")}),TOAST_TIME_MS)}exports.showToast=showToast},50905:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.renderToolbar=void 0;const react_1=__importDefault(__webpack_require__(67294));const react_dom_1=__importDefault(__webpack_require__(73935));const react_redux_1=__webpack_require__(85656);const Toolbar_1=__importDefault(__webpack_require__(12993));const state_1=__webpack_require__(71180);const TOOLBAR_ID="toolbar-xmnk";function getToolbarDiv(){let div=document.getElementById(TOOLBAR_ID);if(!div){div=document.createElement("div");div.id=TOOLBAR_ID;document.body.appendChild(div)}return div}function renderToolbar(){react_dom_1.default.render(react_1.default.createElement(react_redux_1.Provider,{store:state_1.store},react_1.default.createElement(Toolbar_1.default,null)),getToolbarDiv())}exports.renderToolbar=renderToolbar},72701:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.resetGamepadGlobals=exports.isEnabled=exports.enableSimulator=exports.modifyGamepadGlobals=exports.simulateGamepadDisconnect=exports.simulateGamepadConnect=exports.simulateAxeMove=exports.simulateAxeDirUnpress=exports.simulateAxeDirPress=exports.simulateBtnUnpress=exports.simulateBtnPress=exports.simulateBtnTouch=void 0;const types_1=__webpack_require__(42388);let useFakeController=false;const origGetGamepads=navigator.getGamepads.bind(navigator);const fakeController={axes:[0,0,0,0],buttons:[{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0},{pressed:false,touched:false,value:0}],connected:false,id:"Xbox 360 Controller (XInput STANDARD GAMEPAD)",index:0,mapping:"standard",timestamp:performance.now(),hapticActuators:[]};const axeStates={};const getAxePosForDirection=direction=>[types_1.Direction.UP,types_1.Direction.DOWN].indexOf(direction)>-1?1:0;const getOppositeDirection=direction=>{switch(direction){case types_1.Direction.UP:return types_1.Direction.DOWN;case types_1.Direction.DOWN:return types_1.Direction.UP;case types_1.Direction.LEFT:return types_1.Direction.RIGHT;case types_1.Direction.RIGHT:return types_1.Direction.LEFT}};const getValueForDirection=direction=>[types_1.Direction.UP,types_1.Direction.LEFT].indexOf(direction)>-1?-1:1;function simulateBtnTouch(buttonIndex){fakeController.buttons[buttonIndex].touched=true;fakeController.timestamp=performance.now()}exports.simulateBtnTouch=simulateBtnTouch;function simulateBtnPress(buttonIndex){fakeController.buttons[buttonIndex].pressed=true;fakeController.buttons[buttonIndex].value=1;fakeController.timestamp=performance.now()}exports.simulateBtnPress=simulateBtnPress;function simulateBtnUnpress(buttonIndex){fakeController.buttons[buttonIndex].touched=false;fakeController.buttons[buttonIndex].pressed=false;fakeController.buttons[buttonIndex].value=0;fakeController.timestamp=performance.now()}exports.simulateBtnUnpress=simulateBtnUnpress;function simulateAxeDirPress(axe,direction){axeStates[direction]=true;const pos=getAxePosForDirection(direction);const value=getValueForDirection(direction);const oppositeDirection=getOppositeDirection(direction);fakeController.axes[axe*2+pos]=value+(axeStates[oppositeDirection]?getValueForDirection(oppositeDirection):0);fakeController.timestamp=performance.now()}exports.simulateAxeDirPress=simulateAxeDirPress;function simulateAxeDirUnpress(axe,direction){axeStates[direction]=false;const pos=getAxePosForDirection(direction);const oppositeDirection=getOppositeDirection(direction);fakeController.axes[axe*2+pos]=axeStates[oppositeDirection]?getValueForDirection(oppositeDirection):0;fakeController.timestamp=performance.now()}exports.simulateAxeDirUnpress=simulateAxeDirUnpress;function simulateAxeMove(axe,x,y){fakeController.axes[axe*2]=x;fakeController.axes[axe*2+1]=y;fakeController.timestamp=performance.now()}exports.simulateAxeMove=simulateAxeMove;function simulateGamepadConnect(){const event=new Event("gamepadconnected");fakeController.connected=true;fakeController.timestamp=performance.now();event.gamepad=fakeController;window.dispatchEvent(event)}exports.simulateGamepadConnect=simulateGamepadConnect;function simulateGamepadDisconnect(){const event=new Event("gamepaddisconnected");fakeController.connected=false;fakeController.timestamp=performance.now();event.gamepad=fakeController;window.dispatchEvent(event)}exports.simulateGamepadDisconnect=simulateGamepadDisconnect;function modifyGamepadGlobals(){navigator.getGamepads=function getGamepads(){return useFakeController?[Object.assign({},fakeController)]:origGetGamepads()}}exports.modifyGamepadGlobals=modifyGamepadGlobals;function enableSimulator(enable){useFakeController=enable;if(enable){simulateGamepadConnect()}else{simulateGamepadDisconnect()}}exports.enableSimulator=enableSimulator;function isEnabled(){return useFakeController}exports.isEnabled=isEnabled;function resetGamepadGlobals(){navigator.getGamepads=origGetGamepads}exports.resetGamepadGlobals=resetGamepadGlobals},71180:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.selectors=exports.actions=exports.store=void 0;const toolkit_1=__webpack_require__(99639);const defaults_1=__webpack_require__(53201);const initialPresetState={presetName:null,preset:null};const presetSlice=(0,toolkit_1.createSlice)({name:"preset",initialState:initialPresetState,reducers:{updatePreset:(state,action)=>{const{presetName,preset}=action.payload;state.presetName=presetName;state.preset=preset}}});const initialMouseState={status:"not-listening"};const mouseSlice=(0,toolkit_1.createSlice)({name:"mouse",initialState:initialMouseState,reducers:{setListening:(state,action)=>{state.status=action.payload;return state}}});const prefsSlice=(0,toolkit_1.createSlice)({name:"prefs",initialState:defaults_1.defaultPrefs,reducers:{updatePrefs:(state,action)=>action.payload}});exports.store=(0,toolkit_1.configureStore)({reducer:{preset:presetSlice.reducer,mouse:mouseSlice.reducer,prefs:prefsSlice.reducer}});exports.actions=Object.assign(Object.assign(Object.assign({},mouseSlice.actions),presetSlice.actions),prefsSlice.actions);exports.selectors={selectMouse:state=>state.mouse,selectPreset:state=>state.preset,selectPrefs:state=>state.prefs}},50502:(__unused_webpack_module,exports,__webpack_require__)=>{var __webpack_unused_export__;__webpack_unused_export__={value:true};const browserEventProcessor_1=__webpack_require__(34988);const onboarding_1=__webpack_require__(74945);const snackbar_1=__webpack_require__(40883);const toolbar_1=__webpack_require__(50905);const gamepadSimulator_1=__webpack_require__(72701);const state_1=__webpack_require__(71180);const messages_1=__webpack_require__(28724);const gameStartStopPollTimeMs=1e3;let active=false;let isXbox=false;let interval;(0,gamepadSimulator_1.modifyGamepadGlobals)();function getXboxGameInfo(){const inGameUrlRegex=/^https:\/\/(www.)?xbox.com\/[\w-]+\/play\/launch\/[\w-]+\/([A-Z0-9]+)/i;const matches=window.location.href.match(inGameUrlRegex);if(matches&&matches[1]){const gameId=matches[1];const titleSplit=document.title.split(/\s+\|/);if(titleSplit.length===2){const gameName=titleSplit[0];return{gameName,gameId}}}return null}function checkIfInGame(){const{gameName,gameId}=getXboxGameInfo()||{gameName:null,gameId:null};let isInGame=!isXbox;if(isXbox){const h1=document.querySelector("h1");const closeBtn=document.querySelector("[data-id='ui-container'] [aria-label='Close']");const streamDiv=document.getElementById("game-stream");isInGame=!h1&&!closeBtn&&!!streamDiv}return{isInGame,gameName,gameId}}function disableVirtualGamepad(){if((0,gamepadSimulator_1.isEnabled)()){(0,snackbar_1.showToast)("Mouse/keyboard disabled")}(0,browserEventProcessor_1.disableConfig)();state_1.store.dispatch(state_1.actions.updatePreset({presetName:null,preset:null}))}function updateActiveGamepadConfig(name,config){if(!name||!config){disableVirtualGamepad();return}(0,snackbar_1.showToast)(`'${name}' preset activated`);(0,browserEventProcessor_1.enableConfig)(config);state_1.store.dispatch(state_1.actions.updatePreset({presetName:name,preset:config}))}function cancelEvent(event){event.stopImmediatePropagation();event.stopPropagation();event.preventDefault()}function isValidMsgEvent(event){if(event.source!=window||!event.data||event.data.source!=="xcloud-keyboard-mouse-content-script"){return false}return true}function messageListener(event){if(!isValidMsgEvent(event)){return}const msg=event.data;if(msg.type===messages_1.MessageTypes.INITIALIZE_RESPONSE){if(!msg.seenOnboarding){(0,onboarding_1.renderOnboardingIntro)((()=>{updateActiveGamepadConfig(msg.name,msg.gamepadConfig);(0,messages_1.postMessageToWindow)((0,messages_1.seenOnboardingMsg)())}))}else{updateActiveGamepadConfig(msg.name,msg.gamepadConfig)}state_1.store.dispatch(state_1.actions.updatePrefs(msg.prefs))}else if(msg.type===messages_1.MessageTypes.ACTIVATE_GAMEPAD_CONFIG){updateActiveGamepadConfig(msg.name,msg.gamepadConfig)}else if(msg.type===messages_1.MessageTypes.UPDATE_PREFS){state_1.store.dispatch(state_1.actions.updatePrefs(msg.prefs))}}function handleGameEnded(){clearInterval(interval);window.removeEventListener("message",messageListener);document.removeEventListener("visibilitychange",cancelEvent);window.removeEventListener("focusout",cancelEvent);window.removeEventListener("blur",cancelEvent);disableVirtualGamepad();(0,messages_1.postMessageToWindow)((0,messages_1.gameChangedMsg)(null));pollForActiveGame()}function handleGameStarted(gameName){(0,messages_1.postMessageToWindow)((0,messages_1.intializedMsg)(gameName));window.addEventListener("message",messageListener);document.addEventListener("visibilitychange",cancelEvent);window.addEventListener("focusout",cancelEvent);window.addEventListener("blur",cancelEvent);clearInterval(interval);interval=setInterval((()=>{const{isInGame}=checkIfInGame();if(!isInGame){handleGameEnded()}}),gameStartStopPollTimeMs)}function pollForActiveGame(){clearInterval(interval);interval=setInterval((()=>{const{isInGame,gameName}=checkIfInGame();if(isInGame){clearInterval(interval);handleGameStarted(gameName)}}),gameStartStopPollTimeMs)}function onboardingListner(event){if(!isValidMsgEvent(event)){return}const msg=event.data;if(msg.type===messages_1.MessageTypes.SEEN_ONBOARDING){if(msg.seen===false&&!checkIfInGame().isInGame){(0,onboarding_1.renderOnboardingIntro)((()=>{(0,messages_1.postMessageToWindow)((0,messages_1.seenOnboardingMsg)())}))}}else if(msg.type===messages_1.MessageTypes.DISMISS_ONBOARDING){(0,onboarding_1.dismissOnboardingIntro)()}}function bootstrap(){if(active){return}isXbox=/^https:\/\/(www.)?xbox.com/i.test(window.location.href);if(!isXbox||/^https:\/\/(www.)?xbox.com\/[\w-]+\/play/i.test(window.location.href)){if(active){return}active=true;window.addEventListener("message",onboardingListner);(0,messages_1.postMessageToWindow)((0,messages_1.injectedMsg)());(0,toolbar_1.renderToolbar)();pollForActiveGame()}}window.addEventListener("load",bootstrap,false);window.addEventListener("pageshow",bootstrap,false);window.history.pushState=new Proxy(window.history.pushState,{apply:(target,thisArg,argArray)=>{const output=target.apply(thisArg,argArray);bootstrap();return output}});if((window===null||window===void 0?void 0:window.XKBM_FORCE_BOOTSTRAP)===true&&document.readyState==="complete"){setTimeout(bootstrap,10)}}};var __webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={id:moduleId,exports:{}};__webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__);return module.exports}__webpack_require__.m=__webpack_modules__;(()=>{var deferred=[];__webpack_require__.O=(result,chunkIds,fn,priority)=>{if(chunkIds){priority=priority||0;for(var i=deferred.length;i>0&&deferred[i-1][2]>priority;i--)deferred[i]=deferred[i-1];deferred[i]=[chunkIds,fn,priority];return}var notFulfilled=Infinity;for(var i=0;i<deferred.length;i++){var[chunkIds,fn,priority]=deferred[i];var fulfilled=true;for(var j=0;j<chunkIds.length;j++){if((priority&1===0||notFulfilled>=priority)&&Object.keys(__webpack_require__.O).every((key=>__webpack_require__.O[key](chunkIds[j])))){chunkIds.splice(j--,1)}else{fulfilled=false;if(priority<notFulfilled)notFulfilled=priority}}if(fulfilled){deferred.splice(i--,1);var r=fn();if(r!==undefined)result=r}}return result}})();(()=>{__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module["default"]:()=>module;__webpack_require__.d(getter,{a:getter});return getter}})();(()=>{__webpack_require__.d=(exports,definition)=>{for(var key in definition){if(__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)){Object.defineProperty(exports,key,{enumerable:true,get:definition[key]})}}}})();(()=>{__webpack_require__.g=function(){if(typeof globalThis==="object")return globalThis;try{return this||new Function("return this")()}catch(e){if(typeof window==="object")return window}}()})();(()=>{__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)})();(()=>{__webpack_require__.r=exports=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})}})();(()=>{__webpack_require__.j=795})();(()=>{var installedChunks={795:0};__webpack_require__.O.j=chunkId=>installedChunks[chunkId]===0;var webpackJsonpCallback=(parentChunkLoadingFunction,data)=>{var[chunkIds,moreModules,runtime]=data;var moduleId,chunkId,i=0;if(chunkIds.some((id=>installedChunks[id]!==0))){for(moduleId in moreModules){if(__webpack_require__.o(moreModules,moduleId)){__webpack_require__.m[moduleId]=moreModules[moduleId]}}if(runtime)var result=runtime(__webpack_require__)}if(parentChunkLoadingFunction)parentChunkLoadingFunction(data);for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(__webpack_require__.o(installedChunks,chunkId)&&installedChunks[chunkId]){installedChunks[chunkId][0]()}installedChunks[chunkId]=0}return __webpack_require__.O(result)};var chunkLoadingGlobal=self["webpackChunkxcloud_keyboard_mouse"]=self["webpackChunkxcloud_keyboard_mouse"]||[];chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null,0));chunkLoadingGlobal.push=webpackJsonpCallback.bind(null,chunkLoadingGlobal.push.bind(chunkLoadingGlobal))})();(()=>{__webpack_require__.nc=undefined})();var __webpack_exports__=__webpack_require__.O(undefined,[736],(()=>__webpack_require__(50502)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();